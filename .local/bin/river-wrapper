#!/usr/bin/env sh
#
# river‑wrapper — launch River with 1.5× scaling, proper env, and logging

# --- Ensure screenshot & video dirs exist --------------------------------
mkdir -p "$HOME/Pictures" \
         "$HOME/Videos/recording" \
         "$HOME/Videos/fullscreen"

# --- Logging ---------------------------------------------------------------
LOGDIR="${XDG_CACHE_HOME:-$HOME/.cache}"
LOGFILE="$LOGDIR/river-wrapper.log"
mkdir -p "$LOGDIR"
printf '✅ %s: starting river\n' "$(date '+%Y-%m-%d %H:%M:%S')" >> "$LOGFILE"

# --- Inherit user env (optional) ------------------------------------------
[ -r "$HOME/.profile" ] && . "$HOME/.profile"
systemctl --user import-environment || true

# --- Compositor output scaling (Wayland layer) ----------------------------
wlr-randr --output eDP-1 --scale 1.25
wlr-randr --output HDMI-A-1 --scale 1.0

# --- HiDPI Scaling (GTK/QT/Clutter/Xft) ------------------------------------
# GTK / GDK
export GDK_SCALE=1
export GDK_DPI_SCALE=1.2.
# Qt
export QT_AUTO_SCREEN_SCALE_FACTOR=0
export QT_SCALE_FACTOR=1.25
# Clutter
export CLUTTER_SCALE=1.25
# Xft (XWayland)
export XFT_DPI=120    # 96 * 1.5 = 144

# --- Desktop/session identifiers ------------------------------------------
export XDG_SESSION_TYPE=wayland
export XDG_CURRENT_DESKTOP=river
export XDG_SESSION_DESKTOP=river

# --- Enable Wayland backends & portals ------------------------------------
export MOZ_ENABLE_WAYLAND=1
# Optionally ensure portals are running (if you’ve enabled them):
systemctl --user start xdg-desktop-portal.service \
                       xdg-desktop-portal-wlr.service 2>/dev/null || true

# --- Cursor ----------------------------------------------------------------
export XCURSOR_SIZE=48
export XCURSOR_THEME=Breeze

# --- Finally, exec River --------------------------------------------------
exec river
